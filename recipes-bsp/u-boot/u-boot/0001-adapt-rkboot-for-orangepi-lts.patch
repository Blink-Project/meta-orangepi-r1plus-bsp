From 5b1efafa1fc08334fce71b29fa347b5091caf2c1 Mon Sep 17 00:00:00 2001
From: Alexi Demers <alexidemers@gmail.com>
Date: Mon, 7 Nov 2022 21:22:17 -0500
Subject: [PATCH] Set root device in uboot instead of device tree

---
 include/configs/rk3328_common.h   |  2 ++
 include/configs/rockchip-common.h | 21 ++++++++++++---------
 2 files changed, 14 insertions(+), 9 deletions(-)

diff --git a/include/configs/rk3328_common.h b/include/configs/rk3328_common.h
index f43fde4..245e657 100644
--- a/include/configs/rk3328_common.h
+++ b/include/configs/rk3328_common.h
@@ -62,6 +62,8 @@
 	RKIMG_DET_BOOTDEV \
 	"partitions=" PARTS_DEFAULT \
 	ROCKCHIP_DEVICE_SETTINGS \
+	BOOTARGS_ROOTA \
+	BOOTARGS_ROOTB \
 	BOOTENV
 
 #endif
diff --git a/include/configs/rockchip-common.h b/include/configs/rockchip-common.h
index e5b8368..33a86c4 100644
--- a/include/configs/rockchip-common.h
+++ b/include/configs/rockchip-common.h
@@ -135,15 +135,18 @@
 		"setenv devtype ramdisk; setenv devnum 0;" \
 	"fi; \0"
 
-#if defined(CONFIG_AVB_VBMETA_PUBLIC_KEY_VALIDATE)
-#define RKIMG_BOOTCOMMAND			\
-	"boot_android ${devtype} ${devnum};"
-#else
-#define RKIMG_BOOTCOMMAND			\
-	"boot_android ${devtype} ${devnum};"	\
-	"bootrkp;"				\
-	"run distro_bootcmd;"
-#endif
+#define RKIMG_BOOTCOMMAND		\
+	"if load mmc 1:3 0x4000000 bankb; then \
+		setenv bootargs \"${bootargs} root=${bootarg_rootb}\"; \
+	else \
+		setenv bootargs \"${bootargs} root=${bootarg_roota}\";\
+	fi; \
+	ext2load mmc 1:3 0x00280000 Image; \
+	ext2load mmc 1:3 0x08300000 orangepi-r1plus-lts.dtb; \
+	booti 0x00280000 - 0x08300000;"
+
+#define BOOTARGS_ROOTA "bootarg_roota=/dev/mmcblk0p4\0"
+#define BOOTARGS_ROOTB "bootarg_rootb=/dev/mmcblk0p5\0"
 
 #endif /* CONFIG_SPL_BUILD */
 
-- 
2.34.1

